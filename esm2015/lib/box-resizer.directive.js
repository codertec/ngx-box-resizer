import { Directive, ElementRef, Input, Renderer2 } from "@angular/core";
export class ResizerDirective {
    constructor(renderer, elementRef) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.reSizeInput = {};
    }
    captureInputs() {
        this.reSizeInput.xResizer =
            this.boxReSizeInput && this.boxReSizeInput.yResizer
                ? this.boxReSizeInput.yResizer
                : true;
        this.reSizeInput.xMinWidth =
            this.boxReSizeInput && this.boxReSizeInput.xMinWidth
                ? this.boxReSizeInput.xMinWidth
                : 30;
        this.reSizeInput.xMaxWidth =
            this.boxReSizeInput && this.boxReSizeInput.xMaxWidth
                ? this.boxReSizeInput.xMaxWidth
                : 400;
        this.reSizeInput.xDragIndicator = this.boxReSizeInput && this.boxReSizeInput.xDragIndicator
            ? this.boxReSizeInput.xDragIndicator
            : `<div style="position: absolute;
    height: 100%;
    width: 10px;
    background: #e7e7e7;
    cursor: e-resize;
    top: 0px;
    right: 0px;"></div>`;
        this.reSizeInput.yResizer =
            this.boxReSizeInput && this.boxReSizeInput.yResizer
                ? this.boxReSizeInput.yResizer
                : false;
        this.reSizeInput.yMinHeight =
            this.boxReSizeInput && this.boxReSizeInput.yMinHeight
                ? this.boxReSizeInput.yMinHeight
                : 200;
        this.reSizeInput.yMaxHeight =
            this.boxReSizeInput && this.boxReSizeInput.yMaxHeight
                ? this.boxReSizeInput.yMaxHeight
                : 800;
        this.reSizeInput.yDragIndicator = this.boxReSizeInput && this.boxReSizeInput.yDragIndicator
            ? this.boxReSizeInput.yDragIndicator
            : `<div style="position: absolute;
        height: 10px;
        width: 100%;
        background: #e7e7e7;
        cursor: n-resize;
        bottom: 0px;
        left: 0px;"></div>`;
    }
    ngOnInit() {
        this.captureInputs();
        if (this.reSizeInput && this.reSizeInput.xResizer) {
            this.onResizeX();
        }
        if (this.reSizeInput && this.reSizeInput.yResizer) {
            this.onResizeY();
        }
    }
    onResizeX() {
        const childX = window.document.createElement("box-resizer-drag-x");
        childX.innerHTML = this.reSizeInput.xDragIndicator;
        this.renderer.setStyle(this.elementRef.nativeElement, "position", "relative");
        this.renderer.setStyle(this.elementRef.nativeElement, "flex", `initial`);
        this.renderer.appendChild(this.elementRef.nativeElement, childX);
        this.renderer.listen(window.document, "mouseup", (event) => {
            if (this.listenerMouseMove) {
                this.listenerMouseMove();
                this.noSelectCssToogle(false);
            }
        });
        this.renderer.listen(childX, "mousedown", (event) => {
            this.noSelectCssToogle(true);
            // this.onResizeX();
            this.listenerMouseMove = this.renderer.listen(window.document, "mousemove", (event) => {
                let width = event.clientX -
                    this.elementRef.nativeElement.getBoundingClientRect().left;
                if ((this.reSizeInput && this.reSizeInput.xMinWidth) && (width < this.reSizeInput.xMinWidth)) {
                    width = this.reSizeInput.xMinWidth;
                }
                if ((this.reSizeInput && this.reSizeInput.xMaxWidth) && (width > this.reSizeInput.xMaxWidth)) {
                    width = this.reSizeInput.xMaxWidth;
                }
                this.elementRef.nativeElement.style.width = width + "px";
            });
        });
    }
    onResizeY() {
        const childX = window.document.createElement("box-resizer-drag-y");
        childX.innerHTML = this.reSizeInput && this.reSizeInput.yDragIndicator;
        this.renderer.setStyle(this.elementRef.nativeElement, "position", "relative");
        this.renderer.setStyle(this.elementRef.nativeElement, "flex", `initial`);
        this.renderer.appendChild(this.elementRef.nativeElement, childX);
        this.renderer.listen(window.document, "mouseup", (event) => {
            if (this.listenerMouseMove) {
                this.listenerMouseMove();
                this.noSelectCssToogle(false);
            }
        });
        this.renderer.listen(childX, "mousedown", (event) => {
            this.noSelectCssToogle(true);
            // this.onResizeX();
            this.listenerMouseMove = this.renderer.listen(window.document, "mousemove", (event) => {
                let height = event.clientY -
                    this.elementRef.nativeElement.getBoundingClientRect().top;
                if ((this.reSizeInput && this.reSizeInput.yMinHeight) && (height < this.reSizeInput.yMinHeight)) {
                    height = this.reSizeInput.yMinHeight;
                }
                if ((this.reSizeInput && this.reSizeInput.yMaxHeight) && (height > this.reSizeInput.yMaxHeight)) {
                    height = this.reSizeInput.yMaxHeight;
                }
                this.elementRef.nativeElement.style.height = height + "px";
            });
        });
    }
    noSelectCssToogle(value) {
        const sheet = window.document.styleSheets[0];
        if (value) {
            sheet.insertRule(`body { -webkit-touch-callout: none;
          -webkit-user-select: none;
          -khtml-user-select: none;
            -moz-user-select: none;
              -ms-user-select: none;
                  user-select: none;; }`, 0);
        }
        else {
            sheet.removeRule(0);
        }
    }
}
ResizerDirective.decorators = [
    { type: Directive, args: [{
                selector: "[boxResizer]",
            },] }
];
ResizerDirective.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
ResizerDirective.propDecorators = {
    boxReSizeInput: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm94LXJlc2l6ZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvYm94LXJlc2l6ZXIvc3JjL2xpYi9ib3gtcmVzaXplci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQWlCeEUsTUFBTSxPQUFPLGdCQUFnQjtJQU8zQixZQUFvQixRQUFtQixFQUFVLFVBQXNCO1FBQW5ELGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBSnZFLGdCQUFXLEdBQW1CLEVBQUUsQ0FBQztJQUl5QyxDQUFDO0lBRW5FLGFBQWE7UUFDbkIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRO1lBQ3ZCLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRO2dCQUNqRCxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRO2dCQUM5QixDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ1gsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTO1lBQ3hCLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTO2dCQUNsRCxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTO2dCQUMvQixDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ1QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTO1lBQ3hCLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTO2dCQUNsRCxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTO2dCQUMvQixDQUFDLENBQUMsR0FBRyxDQUFDO1FBRVYsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJ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QyxXQUFXLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsRUFBRTtvQkFDL0YsTUFBTSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDO2lCQUN0QztnQkFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDN0QsQ0FBQyxDQUNGLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFHRCxpQkFBaUIsQ0FBQyxLQUFjO1FBQzlCLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdDLElBQUksS0FBSyxFQUFFO1lBQ1QsS0FBSyxDQUFDLFVBQVUsQ0FDZDs7Ozs7d0NBS2dDLEVBQ2hDLENBQUMsQ0FDRixDQUFDO1NBQ0g7YUFBTTtZQUNMLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDckI7SUFDSCxDQUFDOzs7WUFwS0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxjQUFjO2FBQ3pCOzs7WUFoQnNDLFNBQVM7WUFBNUIsVUFBVTs7OzZCQW1CM0IsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSW5wdXQsIFJlbmRlcmVyMiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgYm94UmVTaXplSW5wdXQge1xuICB4UmVzaXplcj86IGJvb2xlYW47XG4gIHhNaW5XaWR0aD86IG51bWJlcjtcbiAgeE1heFdpZHRoPzogbnVtYmVyO1xuICB4RHJhZ0luZGljYXRvcj8gOiBhbnk7XG5cbiAgeVJlc2l6ZXI/OiBib29sZWFuO1xuICB5TWluSGVpZ2h0PzogbnVtYmVyO1xuICB5TWF4SGVpZ2h0PzogbnVtYmVyO1xuICB5RHJhZ0luZGljYXRvcj8gOiBhbnk7XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogXCJbYm94UmVzaXplcl1cIixcbn0pXG5leHBvcnQgY2xhc3MgUmVzaXplckRpcmVjdGl2ZSB7XG5cbiAgQElucHV0KCkgYm94UmVTaXplSW5wdXQ6IGJveFJlU2l6ZUlucHV0IHwgdW5kZWZpbmVkO1xuICByZVNpemVJbnB1dDogYm94UmVTaXplSW5wdXQgPSB7fTtcblxuICBsaXN0ZW5lck1vdXNlTW92ZTogKCgpID0+IHZvaWQpIHwgdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIHByaXZhdGUgY2FwdHVyZUlucHV0cygpIHtcbiAgICB0aGlzLnJlU2l6ZUlucHV0LnhSZXNpemVyID1cbiAgICAgIHRoaXMuYm94UmVTaXplSW5wdXQgJiYgdGhpcy5ib3hSZVNpemVJbnB1dC55UmVzaXplclxuICAgICAgICA/IHRoaXMuYm94UmVTaXplSW5wdXQueVJlc2l6ZXJcbiAgICAgICAgOiB0cnVlO1xuICAgIHRoaXMucmVTaXplSW5wdXQueE1pbldpZHRoID1cbiAgICAgIHRoaXMuYm94UmVTaXplSW5wdXQgJiYgdGhpcy5ib3hSZVNpemVJbnB1dC54TWluV2lkdGhcbiAgICAgICAgPyB0aGlzLmJveFJlU2l6ZUlucHV0LnhNaW5XaWR0aFxuICAgICAgICA6IDMwO1xuICAgIHRoaXMucmVTaXplSW5wdXQueE1heFdpZHRoID1cbiAgICAgIHRoaXMuYm94UmVTaXplSW5wdXQgJiYgdGhpcy5ib3hSZVNpemVJbnB1dC54TWF4V2lkdGhcbiAgICAgICAgPyB0aGlzLmJveFJlU2l6ZUlucHV0LnhNYXhXaWR0aFxuICAgICAgICA6IDQwMDtcbiAgICBcbiAgICB0aGlzLnJlU2l6ZUlucHV0LnhEcmFnSW5kaWNhdG9yID0gdGhpcy5ib3hSZVNpemVJbnB1dCAmJiB0aGlzLmJveFJlU2l6ZUlucHV0LnhEcmFnSW5kaWNhdG9yXG4gICAgPyB0aGlzLmJveFJlU2l6ZUlucHV0LnhEcmFnSW5kaWNhdG9yXG4gICAgOiBgPGRpdiBzdHlsZT1cInBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgd2lkdGg6IDEwcHg7XG4gICAgYmFja2dyb3VuZDogI2U3ZTdlNztcbiAgICBjdXJzb3I6IGUtcmVzaXplO1xuICAgIHRvcDogMHB4O1xuICAgIHJpZ2h0OiAwcHg7XCI+PC9kaXY+YFxuXG4gICAgdGhpcy5yZVNpemVJbnB1dC55UmVzaXplciA9XG4gICAgICB0aGlzLmJveFJlU2l6ZUlucHV0ICYmIHRoaXMuYm94UmVTaXplSW5wdXQueVJlc2l6ZXJcbiAgICAgICAgPyB0aGlzLmJveFJlU2l6ZUlucHV0LnlSZXNpemVyXG4gICAgICAgIDogZmFsc2U7XG4gICAgdGhpcy5yZVNpemVJbnB1dC55TWluSGVpZ2h0ID1cbiAgICAgIHRoaXMuYm94UmVTaXplSW5wdXQgJiYgdGhpcy5ib3hSZVNpemVJbnB1dC55TWluSGVpZ2h0XG4gICAgICAgID8gdGhpcy5ib3hSZVNpemVJbnB1dC55TWluSGVpZ2h0XG4gICAgICAgIDogMjAwO1xuICAgIHRoaXMucmVTaXplSW5wdXQueU1heEhlaWdodCA9XG4gICAgICB0aGlzLmJveFJlU2l6ZUlucHV0ICYmIHRoaXMuYm94UmVTaXplSW5wdXQueU1heEhlaWdodFxuICAgICAgICA/IHRoaXMuYm94UmVTaXplSW5wdXQueU1heEhlaWdodFxuICAgICAgICA6IDgwMDtcblxuICAgIHRoaXMucmVTaXplSW5wdXQueURyYWdJbmRpY2F0b3IgPSB0aGlzLmJveFJlU2l6ZUlucHV0ICYmIHRoaXMuYm94UmVTaXplSW5wdXQueURyYWdJbmRpY2F0b3JcbiAgICA/IHRoaXMuYm94UmVTaXplSW5wdXQueURyYWdJbmRpY2F0b3JcbiAgICA6IGA8ZGl2IHN0eWxlPVwicG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICBoZWlnaHQ6IDEwcHg7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBiYWNrZ3JvdW5kOiAjZTdlN2U3O1xuICAgICAgICBjdXJzb3I6IG4tcmVzaXplO1xuICAgICAgICBib3R0b206IDBweDtcbiAgICAgICAgbGVmdDogMHB4O1wiPjwvZGl2PmBcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY2FwdHVyZUlucHV0cygpO1xuICAgIGlmICh0aGlzLnJlU2l6ZUlucHV0ICYmIHRoaXMucmVTaXplSW5wdXQueFJlc2l6ZXIpIHtcbiAgICAgIHRoaXMub25SZXNpemVYKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlU2l6ZUlucHV0ICYmIHRoaXMucmVTaXplSW5wdXQueVJlc2l6ZXIpIHtcbiAgICAgIHRoaXMub25SZXNpemVZKCk7XG4gICAgfVxuICB9XG5cbiAgb25SZXNpemVYKCkge1xuICAgIGNvbnN0IGNoaWxkWCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYm94LXJlc2l6ZXItZHJhZy14XCIpO1xuICAgIGNoaWxkWC5pbm5lckhUTUwgPSB0aGlzLnJlU2l6ZUlucHV0LnhEcmFnSW5kaWNhdG9yO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoXG4gICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgIFwicG9zaXRpb25cIixcbiAgICAgIFwicmVsYXRpdmVcIlxuICAgICk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgXCJmbGV4XCIsIGBpbml0aWFsYCk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgY2hpbGRYKTtcbiAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3cuZG9jdW1lbnQsIFwibW91c2V1cFwiLCAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmICh0aGlzLmxpc3RlbmVyTW91c2VNb3ZlKSB7XG4gICAgICAgIHRoaXMubGlzdGVuZXJNb3VzZU1vdmUoKTtcbiAgICAgICAgdGhpcy5ub1NlbGVjdENzc1Rvb2dsZShmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihjaGlsZFgsIFwibW91c2Vkb3duXCIsIChldmVudDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgdGhpcy5ub1NlbGVjdENzc1Rvb2dsZSh0cnVlKTtcbiAgICAgIC8vIHRoaXMub25SZXNpemVYKCk7XG4gICAgICB0aGlzLmxpc3RlbmVyTW91c2VNb3ZlID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oXG4gICAgICAgIHdpbmRvdy5kb2N1bWVudCxcbiAgICAgICAgXCJtb3VzZW1vdmVcIixcbiAgICAgICAgKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgbGV0IHdpZHRoOiBhbnkgPVxuICAgICAgICAgICAgZXZlbnQuY2xpZW50WCAtXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgICAgICAgIGlmICgodGhpcy5yZVNpemVJbnB1dCAmJiB0aGlzLnJlU2l6ZUlucHV0LnhNaW5XaWR0aCkgJiYgKHdpZHRoIDwgdGhpcy5yZVNpemVJbnB1dC54TWluV2lkdGgpKSB7XG4gICAgICAgICAgICB3aWR0aCA9IHRoaXMucmVTaXplSW5wdXQueE1pbldpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoKHRoaXMucmVTaXplSW5wdXQgJiYgdGhpcy5yZVNpemVJbnB1dC54TWF4V2lkdGgpICYmICh3aWR0aCA+IHRoaXMucmVTaXplSW5wdXQueE1heFdpZHRoKSkge1xuICAgICAgICAgICAgd2lkdGggPSB0aGlzLnJlU2l6ZUlucHV0LnhNYXhXaWR0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9uUmVzaXplWSgpIHtcbiAgICBjb25zdCBjaGlsZFggPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJveC1yZXNpemVyLWRyYWcteVwiKTtcbiAgICBjaGlsZFguaW5uZXJIVE1MID0gdGhpcy5yZVNpemVJbnB1dCAmJiB0aGlzLnJlU2l6ZUlucHV0LnlEcmFnSW5kaWNhdG9yO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoXG4gICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgIFwicG9zaXRpb25cIixcbiAgICAgIFwicmVsYXRpdmVcIlxuICAgICk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgXCJmbGV4XCIsIGBpbml0aWFsYCk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgY2hpbGRYKTtcbiAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3cuZG9jdW1lbnQsIFwibW91c2V1cFwiLCAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgIGlmICh0aGlzLmxpc3RlbmVyTW91c2VNb3ZlKSB7XG4gICAgICAgIHRoaXMubGlzdGVuZXJNb3VzZU1vdmUoKTtcbiAgICAgICAgdGhpcy5ub1NlbGVjdENzc1Rvb2dsZShmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihjaGlsZFgsIFwibW91c2Vkb3duXCIsIChldmVudDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgdGhpcy5ub1NlbGVjdENzc1Rvb2dsZSh0cnVlKTtcbiAgICAgIC8vIHRoaXMub25SZXNpemVYKCk7XG4gICAgICB0aGlzLmxpc3RlbmVyTW91c2VNb3ZlID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oXG4gICAgICAgIHdpbmRvdy5kb2N1bWVudCxcbiAgICAgICAgXCJtb3VzZW1vdmVcIixcbiAgICAgICAgKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgbGV0IGhlaWdodCA9XG4gICAgICAgICAgICBldmVudC5jbGllbnRZIC1cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICAgICAgICBpZiAoKHRoaXMucmVTaXplSW5wdXQgJiYgdGhpcy5yZVNpemVJbnB1dC55TWluSGVpZ2h0KSAmJiAoaGVpZ2h0IDwgdGhpcy5yZVNpemVJbnB1dC55TWluSGVpZ2h0KSkge1xuICAgICAgICAgICAgaGVpZ2h0ID0gdGhpcy5yZVNpemVJbnB1dC55TWluSGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoKHRoaXMucmVTaXplSW5wdXQgJiYgdGhpcy5yZVNpemVJbnB1dC55TWF4SGVpZ2h0KSAmJiAoaGVpZ2h0ID4gdGhpcy5yZVNpemVJbnB1dC55TWF4SGVpZ2h0KSkge1xuICAgICAgICAgICAgaGVpZ2h0ID0gdGhpcy5yZVNpemVJbnB1dC55TWF4SGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyBcInB4XCI7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuXG4gIG5vU2VsZWN0Q3NzVG9vZ2xlKHZhbHVlOiBib29sZWFuKSB7XG4gICAgY29uc3Qgc2hlZXQgPSB3aW5kb3cuZG9jdW1lbnQuc3R5bGVTaGVldHNbMF07XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICBzaGVldC5pbnNlcnRSdWxlKFxuICAgICAgICBgYm9keSB7IC13ZWJraXQtdG91Y2gtY2FsbG91dDogbm9uZTtcbiAgICAgICAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lO1xuICAgICAgICAgIC1raHRtbC11c2VyLXNlbGVjdDogbm9uZTtcbiAgICAgICAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7XG4gICAgICAgICAgICAgIC1tcy11c2VyLXNlbGVjdDogbm9uZTtcbiAgICAgICAgICAgICAgICAgIHVzZXItc2VsZWN0OiBub25lOzsgfWAsXG4gICAgICAgIDBcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNoZWV0LnJlbW92ZVJ1bGUoMCk7XG4gICAgfVxuICB9XG59XG4iXX0=